import{_ as te}from"./C5KoYXvH.js";import{d as le,F as ne,r as I,L as ae,k as ie,M as q,o as oe,y as x,C as o,D as n,H as s,$ as E,Z as se,W as N,I as M,g as y,z as i,G as m,A as V,E as w,B as b,N as u,a0 as de,R as G,V as O,Q as re}from"./CThe8rmN.js";import{u as ue}from"./CQW_vi0x.js";import{u as ce}from"./Cqk5BQ_7.js";import{a as B}from"./C4IxTLi6.js";const me={class:"d-flex align-center ga-2 mx-3",style:{height:"64px"}},fe={key:0,class:"ma-4 d-flex flex-column ga-3 pt-2"},ve={class:"d-flex ga-2 ma-4"},ye={key:0,class:"mb-3 d-flex flex-column ga-3"},pe={class:"d-flex ga-2"},ge={class:"ml-2"},he={key:0,class:"my-4"},ke={class:"text-nowrap"},xe={key:1,class:"my-4"},$e={key:2,class:"d-flex justify-center"},Se=le({__name:"DataTable",props:{filters:{type:Array,default:()=>[]},actions:{type:Array,default:()=>["add","active","inactive","delete"]},rowActions:{type:Array,default:()=>["update","delete"]},headers:{type:Array,default:()=>[]},data:{type:Object,default:()=>({docs:[],page:1,limit:20,totalDocs:0})},loading:{type:Boolean,default:!1},showSelect:{type:Boolean,default:!1},hideSearch:{type:Boolean,default:!1}},emits:["change","action","change-filter"],setup(f,{expose:Q,emit:W}){const T=ue(),{t:_}=ne(),{isMobile:H}=ce(),r=f,p=W,g=I(!1),h=I([]),R=I(null),a=ae({search:"",page:1,limit:20}),X=ie(()=>Array.isArray(r.headers)&&r.headers?.length?r.headers.map(l=>({...l,title:_(l.title)})):[]);function Z(l,t){return t.split(".").reduce((C,c)=>C?C[c]:void 0,l)||"---"}function K(){r.filters.forEach(l=>{l.type==="select"&&l.items?.length?a[l.field]||(a[l.field]=l.items[0][l.itemValue||"value"]):l.type==="text"&&(a[l.field]||(a[l.field]=""))})}function j(){h.value=[]}function D(){j(),p("change",a)}function U(l="filter"){l=="search"&&!a.search||(a.page=1,D(),g.value=!1)}const z=(l,t)=>{if(!t?._id&&!h.value?.length){T.onActionSetSystemPopup({type:"error",content:"Vui lòng chọn ít nhất một dữ liệu để thực hiện thao tác này."});return}const C=r.data?.docs.filter($=>h.value.includes($?._id));if(l===B.ACTIVE&&C.some($=>![B.INACTIVE].includes($.status?.code))){T.onActionSetSystemPopup({type:"error",content:"Vui lòng chỉ chọn những dữ liệu có trạng thái: Dự thảo, Tạm dừng."});return}if(l===B.INACTIVE&&C.some($=>![B.ACTIVE].includes($.status?.code))){T.onActionSetSystemPopup({type:"error",content:"Vui lòng chỉ chọn những dữ liệu có trạng thái: Hoạt động."});return}let c="";const S=h.value?.length||0;switch(l){case"active":c=_("Bạn có chắc chắn muốn kích hoạt {amount} dữ liệu?",{amount:S});break;case"inactive":c=_("Bạn có chắc chắn muốn tạm dừng {amount} dữ liệu?",{amount:S});break;case"delete":c=_("Bạn có chắc chắn muốn xóa {amount} dữ liệu?",{amount:S});break}R.value.show({message:c,noTransMsg:!0,onConfirm:async()=>{p("action",{action:l,ids:t?._id?[t._id]:h.value})}})};return q(()=>r.filters,()=>{K()},{immediate:!0}),q(()=>a.search,()=>{a.search||p("change",a)}),oe(()=>{K()}),Q({params:a,selected:h,loadItems:D,resetSelected:j}),(l,t)=>{const C=te,c=y("v-icon"),S=y("v-divider"),$=y("v-text-field"),J=y("v-select"),v=y("v-btn"),Y=y("v-navigation-drawer"),A=y("v-col"),F=y("v-row"),L=y("v-chip"),P=y("v-data-table-server"),ee=y("v-overlay");return i(),x(M,null,[o(C,{ref_key:"confirmDialogRef",ref:R},null,512),o(Y,{temporary:"",modelValue:s(g),"onUpdate:modelValue":t[2]||(t[2]=e=>E(g)?g.value=e:null),width:s(H)?"560":330,location:s(H)?"bottom":"right",style:{"z-index":"99999 !important"}},{prepend:n(()=>[V("div",me,[o(c,{size:"25"},{default:n(()=>[...t[15]||(t[15]=[w("mdi-filter-variant",-1)])]),_:1}),V("h3",null,b(l.$t("Bộ lọc")),1)])]),append:n(()=>[V("div",ve,[o(v,{text:l.$t("Đóng"),variant:"outlined",color:"primary",class:"flex-1",style:{height:"48px"},onClick:t[0]||(t[0]=e=>g.value=!1)},null,8,["text"]),o(v,{text:l.$t("Tìm kiếm"),variant:"flat",color:"primary",class:"flex-1",style:{height:"48px"},onClick:t[1]||(t[1]=e=>U())},null,8,["text"])])]),default:n(()=>[o(S),Array.isArray(f.filters)&&f.filters?.length?(i(),x("div",fe,[(i(!0),x(M,null,N(f.filters,(e,d)=>(i(),x(M,{key:d},[e.type==="text"?(i(),u($,{key:0,modelValue:s(a)[e.field],"onUpdate:modelValue":[k=>s(a)[e.field]=k,k=>p("change-filter",{type:e.type,field:e.field,value:s(a)[e.field]})],variant:"outlined",density:"comfortable",label:e.label?l.$t(e.label):""},null,8,["modelValue","onUpdate:modelValue","label"])):e.type==="select"?(i(),u(J,{key:1,modelValue:s(a)[e.field],"onUpdate:modelValue":[k=>s(a)[e.field]=k,k=>p("change-filter",{type:e.type,field:e.field,value:s(a)[e.field]})],variant:"outlined",density:"comfortable",items:e.items,label:e.label?l.$t(e.label):"","item-title":e.itemTitle||"title","item-value":e.itemValue||"value"},null,8,["modelValue","onUpdate:modelValue","items","label","item-title","item-value"])):m("",!0)],64))),128))])):m("",!0)]),_:1},8,["modelValue","width","location"]),o(P,{"item-value":"_id",modelValue:s(h),"onUpdate:modelValue":t[11]||(t[11]=e=>E(h)?h.value=e:null),page:s(a).page,"onUpdate:page":t[12]||(t[12]=e=>s(a).page=e),"items-per-page":s(a).limit,"onUpdate:itemsPerPage":t[13]||(t[13]=e=>s(a).limit=e),headers:s(X),items:f.data.docs,"items-length":f.data.totalDocs,"items-per-page-options":[20,50,100],loading:f.loading,"show-select":r.showSelect,"hide-default-footer":!f.data.totalDocs,"onUpdate:options":D},se({top:n(()=>[f.hideSearch?m("",!0):(i(),x("div",ye,[o(F,{dense:""},{default:n(()=>[o(A,{cols:"12",lg:"5"},{default:n(()=>[V("div",pe,[o($,{modelValue:s(a).search,"onUpdate:modelValue":t[3]||(t[3]=e=>s(a).search=e),"hide-details":"","single-line":"",density:"comfortable",variant:"outlined","prepend-inner-icon":"mdi-magnify",label:l.$t("Tìm kiếm"),placeholder:l.$t("Tìm kiếm"),onKeyup:t[4]||(t[4]=de(e=>U("search"),["enter"])),"onClick:prependInner":t[5]||(t[5]=e=>U("search"))},null,8,["modelValue","label","placeholder"]),f.filters?.length?(i(),u(v,{key:0,variant:"outlined",color:"primary",style:{height:"48px"},onClick:t[6]||(t[6]=e=>g.value=!0)},{default:n(()=>[o(c,{size:"19"},{default:n(()=>[...t[16]||(t[16]=[w("mdi-filter-variant",-1)])]),_:1}),V("span",ge,b(l.$t("Bộ lọc")),1)]),_:1})):m("",!0)])]),_:1}),o(A,{cols:"12",lg:"7",md:"7"},{default:n(()=>[G(l.$slots,"action",{},()=>[r.actions?.length?(i(),u(F,{key:0,dense:""},{default:n(()=>[t[17]||(t[17]=V("div",{class:"flex-1"},null,-1)),r.actions.includes("add")?(i(),u(A,{key:0,cols:"6",xl:"2",lg:"2",md:"3",sm:"3"},{default:n(()=>[o(v,{text:l.$t("Thêm mới"),style:{height:"48px"},variant:"flat",color:"primary",class:"w-100",onClick:t[7]||(t[7]=e=>p("action",{action:"add"}))},null,8,["text"])]),_:1})):m("",!0),r.actions.includes("active")?(i(),u(A,{key:1,cols:"6",xl:"2",lg:"2",md:"3",sm:"3"},{default:n(()=>[o(v,{text:l.$t("Kích hoạt"),style:{height:"48px"},variant:"flat",color:"green",class:"w-100",onClick:t[8]||(t[8]=e=>z("active"))},null,8,["text"])]),_:1})):m("",!0),r.actions.includes("inactive")?(i(),u(A,{key:2,cols:"6",xl:"2",lg:"2",md:"3",sm:"3"},{default:n(()=>[o(v,{text:l.$t("Tạm dừng"),style:{height:"48px"},variant:"flat",color:"red",class:"w-100",onClick:t[9]||(t[9]=e=>z("inactive"))},null,8,["text"])]),_:1})):m("",!0),r.actions.includes("delete")?(i(),u(A,{key:3,cols:"6",xl:"2",lg:"2",md:"3",sm:"3"},{default:n(()=>[o(v,{text:l.$t("Xoá"),style:{height:"48px"},variant:"flat",color:"error",class:"w-100",onClick:t[10]||(t[10]=e=>z("delete"))},null,8,["text"])]),_:1})):m("",!0)]),_:1})):m("",!0)])]),_:3})]),_:3})]))]),_:2},[N(f.headers,e=>({name:`header.${e.key}`,fn:n(()=>[V("span",{class:O(["font-bold",`text-${e.align||"start"}`])},b(l.$t(e.title)),3)])})),N(f.headers,e=>({name:`item.${e.key}`,fn:n(d=>[G(l.$slots,`row-${e.key}`,{item:d.item,index:d.index},()=>[["createdAt","updatedAt"].includes(e.key)?(i(),x("div",he,[V("span",ke,b(d.item?.[e.key]||"---"),1)])):e.key=="status"?(i(),x("div",xe,[d.item?.[e.key]?.color&&d.item?.[e.key]?.name?(i(),u(L,{key:0,color:d.item?.[e.key]?.color},{default:n(()=>[w(b(l.$t(d.item?.[e.key]?.name)),1)]),_:2},1032,["color"])):(i(),u(L,{key:1},{default:n(()=>[w(b(d.item?.[e.key]),1)]),_:2},1024))])):e.key=="action"?(i(),x("div",$e,[r.rowActions.includes("reload")?(i(),u(v,{key:0,icon:"",size:"40",variant:"text",disabled:!!(d.item?.isDelete||["❌ Hình ảnh tải lên vi phạm chính sách, vui lòng chọn ảnh khác!","❌ Thước phim liên quan đến chủ đề nhạy cảm, vi phạm chính sách nội dung!"].includes(d.item?.lastMessage?.note)),onClick:k=>p("action",{action:"reload",item:d.item})},{default:n(()=>[o(c,{size:"20"},{default:n(()=>[...t[18]||(t[18]=[w("mdi-reload",-1)])]),_:1})]),_:1},8,["disabled","onClick"])):m("",!0),r.rowActions.includes("view")?(i(),u(v,{key:1,icon:"",size:"40",variant:"text",onClick:k=>p("action",{action:"view",item:d.item})},{default:n(()=>[o(c,{size:"20"},{default:n(()=>[...t[19]||(t[19]=[w("mdi-eye-outline",-1)])]),_:1})]),_:1},8,["onClick"])):m("",!0),r.rowActions.includes("update")?(i(),u(v,{key:2,icon:"",size:"40",variant:"text",onClick:k=>p("action",{action:"update",item:d.item})},{default:n(()=>[o(c,{size:"20"},{default:n(()=>[...t[20]||(t[20]=[w("mdi-pencil-outline",-1)])]),_:1})]),_:1},8,["onClick"])):m("",!0),r.rowActions.includes("delete")?(i(),u(v,{key:3,icon:"",size:"40",variant:"text",color:"error",onClick:k=>z("delete",d.item)},{default:n(()=>[o(c,{size:"20"},{default:n(()=>[...t[21]||(t[21]=[w("mdi-trash-can-outline",-1)])]),_:1})]),_:1},8,["onClick"])):m("",!0)])):(i(),x("div",{key:3,class:O(["my-4 text-nowrap",e.class]),style:re({"min-width":e.width})},b(Z(d.item,e.key)),7))])])}))]),1032,["modelValue","page","items-per-page","headers","items","items-length","loading","show-select","hide-default-footer"]),o(ee,{modelValue:s(g),"onUpdate:modelValue":t[14]||(t[14]=e=>E(g)?g.value=e:null),style:{"z-index":"9999 !important"}},null,8,["modelValue"])],64)}}});export{Se as _};
