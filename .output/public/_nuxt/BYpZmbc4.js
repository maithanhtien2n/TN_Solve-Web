const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DM56OIzk.js","./CThe8rmN.js","./entry.B4u3ei2x.css"])))=>i.map(i=>d[i]);
import{d as Q,O as X,r as R,o as G,P as ie,e as se,y as _,z as u,Q as x,A as n,N as p,G as k,H as e,g as y,_ as Y,R as de,C as i,D as s,E as h,B as c,u as re,S as ue,F as ce,a as me,L as ve,k as D,T as fe,U as pe,V as $,W as ge,I as he}from"./CThe8rmN.js";import{d as ye}from"./BrZZEpxw.js";import{E as _e}from"./C4IxTLi6.js";import{u as be}from"./CQW_vi0x.js";import{p as K}from"./BS_QG9T_.js";import{u as we,a as ke}from"./Cqk5BQ_7.js";import{u as Ve}from"./BTM_bmsK.js";const Te={class:"video-content"},$e=Q({__name:"VideoPlayer",props:{frameRate:{type:String,default:"horizontal"},src:{type:String,required:!0},removeControls:{type:Array,default:()=>["settings"]},poster:{type:String,default:""}},setup(M){const P=X(),C=M,b=R(!0),v=R(null),V={controls:["play-large","play","progress","current-time","mute","volume","settings","fullscreen"].filter(w=>!C.removeControls.includes(w)),i18n:{restart:"Chạy lại",rewind:"Tua lại {seektime}s",play:"Phát",pause:"Tạm dừng",fastForward:"Tua nhanh {seektime}s",seek:"Tua",seekLabel:"{currentTime} trong tổng {duration}",played:"Đã xem",buffered:"Đã tải",currentTime:"Thời gian hiện tại",duration:"Tổng thời lượng",volume:"Âm lượng",mute:"Tắt tiếng",unmute:"Bật tiếng",enableCaptions:"Bật phụ đề",disableCaptions:"Tắt phụ đề",download:"Tải xuống",enterFullscreen:"Toàn màn hình",exitFullscreen:"Thoát toàn màn hình",settings:"Cài đặt",menuBack:"Quay lại menu trước",speed:"Tốc độ",normal:"Bình thường",quality:"Chất lượng",captions:"Phụ đề",enabled:"Bật",disabled:"Tắt",advertisement:"Quảng cáo",auto:"Tự động",default:"Mặc định",loop:"Lặp lại"}};let f=null;return G(async()=>{const T=(await ie(()=>import("./DM56OIzk.js"),__vite__mapDeps([0,1,2]),import.meta.url)).default;v.value&&(f=new T(v.value,V),f.source={type:"video",sources:[{src:C.src,type:"video/mp4"}],poster:C.poster}),setTimeout(()=>{b.value=!1},200)}),se(()=>{f?.destroy(),f=null}),(w,T)=>{const g=y("v-skeleton-loader");return u(),_("div",{class:"video-wrapper",style:x({"padding-top":M.frameRate==="vertical"?"177.78%":"56.25%"})},[n("div",Te,[e(b)?(u(),p(g,{key:0,style:{width:"100%",height:"100%"}})):k("",!0),n("div",{style:x({opacity:e(b)?0:1})},[(u(),_("video",{ref_key:"videoPlayerRef",ref:v,playsinline:"",controls:"",key:e(P).fullPath}))],4)])],4)}}}),Ce=Y($e,[["__scopeId","data-v-5bc27bf7"]]),Be={class:"relative",style:{overflow:"hidden",border:"1px solid rgb(197 197 197)","border-radius":"5px"}},Se={key:1,class:"d-flex flex-column ga-1 align-center"},Me=Q({__name:"UploadImage",props:{width:{type:String,default:"100%"},height:{type:String,default:"20rem"},iconUpload:{type:String,default:"mdi-folder-upload-outline"},textUpload:{type:String,default:"Tải ảnh lên"},readonly:{type:Boolean,default:!1}},emits:["onSelectFile"],setup(M,{expose:P,emit:C}){const b=M,v=C,V=R(),f=R(""),w=R(!1),T=B=>{const l=B.target;if(!l.files?.length)return;const r=l.files[0];if(r){w.value=!0;const S=new FileReader;S.onload=U=>{V.value=r,f.value=U.target.result,w.value=!1,v("onSelectFile",{file:V.value,base64:f.value})},S.onerror=()=>{w.value=!1},S.readAsDataURL(r)}l.value=""},g=()=>{V.value=void 0,f.value="",v("onSelectFile",{file:V.value,base64:f.value})};return P({file:V,base64:f,setValue:B=>{f.value=B},hehe:"11"}),(B,l)=>{const r=y("v-img"),S=y("v-icon"),U=y("v-btn"),F=y("v-progress-circular");return u(),_("div",Be,[de(B.$slots,"default"),f.value?(u(),_("div",{key:0,class:"d-flex justify-center align-center relative",style:x({width:b.width,height:b.height})},[i(r,{src:f.value,"lazy-src":f.value,alt:"image-upload",class:"w-100 h-100",style:{"object-fit":"contain"}},{placeholder:s(()=>[i(r,{src:"/images/image-default.svg"})]),_:1},8,["src","lazy-src"]),M.readonly?k("",!0):(u(),p(U,{key:0,icon:"",size:"24",color:"black",style:{position:"absolute"},class:"top-0 right-0 cursor-pointer"},{default:s(()=>[i(S,{size:"20",onClick:g},{default:s(()=>[...l[0]||(l[0]=[h("mdi-close",-1)])]),_:1})]),_:1}))],4)):(u(),_("div",{key:1,class:"d-flex justify-center align-center cursor-pointer relative",style:x({width:b.width,height:b.height})},[w.value?(u(),p(F,{key:0,indeterminate:"",size:"48",width:"2",class:"absolute"})):(u(),_("div",Se,[i(S,{size:"33",color:"grey-darken-1"},{default:s(()=>[h(c(M.iconUpload),1)]),_:1}),n("span",null,c(M.textUpload),1)])),n("input",{type:"file",accept:"image/*",style:{top:"-2rem"},class:"absolute right-0 left-0 bottom-0 cursor-pointer",onChange:T},null,32)],4))])}}}),Re={key:0,class:"d-flex justify-center flex-column align-center ga-3 pt-10 pb-16"},De={key:0,class:"d-flex flex-column ga-3"},Pe={class:"d-flex justify-center rem bg-black",style:{"border-radius":"13px",overflow:"hidden"}},Ue={class:"font-bold mt-2"},ze={class:"font-bold"},Ie={class:"font-bold"},Fe={class:"font-bold"},Ae={class:"font-bold"},Le={class:"font-bold"},je={class:"font-bold"},xe={class:"font-bold"},Oe={class:"font-bold"},Ee=["innerHTML"],Ne={key:1},He={key:0,class:"scan-overlay"},Ge={class:"font-bold"},Qe={class:"text-caption"},qe={key:0,class:"text-caption"},We={key:1,class:"text-caption"},Je={class:"w-100 text-center text-gray-600"},Ke={class:"font-bold text-black"},Xe=Q({__name:"[id]",setup(M){const P=X(),C=re(),b=ue(),{t:v}=ce(),{width:V}=we(),{$socket:f}=me(),{onGetterUserData:w}=be(),{onGetterMasterData:T}=Ve(),g=R(""),z=R(null),B=R(null),l=ve({title:`${v("Video của tôi")} ${new Date().toLocaleTimeString()} ${new Date().toLocaleDateString()}`,value:"",frameRate:"horizontal",modelVideo:"veo3_fast",videoMode:"movie",videoStyle:"general",videoDuration:"8",author:"",images:[],video:"",messages:[],account:{}}),r=D(()=>P.params.id!=="create"?P.params.id:null),S=D(()=>!!(r.value&&l.messages.length&&l.messages[l.messages.length-1]?.color==="error")),U=D(()=>T.value["video-mode"]?.map(o=>({title:v(o.title),value:o.value}))||[]),F=D(()=>T.value["frame-rate"]?.map(o=>({title:v(o.title),value:o.value}))||[]),q=D(()=>T.value["model-video"]||[]),A=D(()=>{const o=T.value["video-style"]?.map(t=>({title:v(t.title),value:t.value}))||[];switch(l.videoMode){case"movie":return o.filter(t=>["general","monologue","narration"].includes(t.value));case"storytelling":return o.filter(t=>["general"].includes(t.value));case"short_form_video":return o.filter(t=>["general","satisfying","asmr"].includes(t.value));case"my_subject":return o.filter(t=>["general","testimonial"].includes(t.value));default:return o}}),L=D(()=>{const o=T.value["video-duration"]||[];if(r.value||l.videoMode==="movie")return o;if(["short_form_video","my_subject"].includes(l.videoMode)){const t=["1","2","3","4","5","6","7"];return o.filter(d=>t.includes(d.value))}else if(["storytelling"].includes(l.videoMode)){const t=["8","12","16","20","24"];return o.filter(d=>t.includes(d.value))}else{const t=["1","2","3","4","5","6","7"];return o.filter(d=>!t.includes(d.value))}}),Z=()=>{B.value&&B.value.scrollIntoView({behavior:"smooth",block:"center"})},W=o=>{if(o)if(o.includes("Tổng cộng có")){const t=o.match(/\d+/),d=t?t[0]:null;return v("Tổng cộng có {amount} cảnh",{amount:d})}else if(o.includes("Hoàn tất tạo video cho")){const t=o.match(/\d+/),d=t?t[0]:null;return v("Hoàn tất tạo video cho {amount} cảnh",{amount:d})}else if(o.includes("Lần thử")){const t=o.match(/\d+\/\d+/g);if(t&&t.length>=2){const[d,E]=t;return v("Lần thử {tryCount}: đang tạo video cho cảnh {sceneCount}...",{tryCount:d,sceneCount:E})}else return o}else if(o.includes("Tổng thời gian hoàn thành")){const[t,d]=o.split(":");return v(t)+`: ${d}`}else return v(o)},O=async(o="")=>{r.value&&(g.value=o,await K.getDetailProduct({_id:r.value}).then(t=>{const d=t?.data;d?(l.title=d.title,l.value=d.value,l.frameRate=d.frameRate,l.modelVideo=d.modelVideo,l.videoMode=d.videoMode,l.videoStyle=d.videoStyle,l.videoDuration=d.videoDuration,l.author=d.author,l.images=[],l.hasImage=!!(Array.isArray(d.images)&&d.images.length),l.video=d.video,l.messages=d.messages||[],l.account=d.account||{},setTimeout(()=>{z.value?.setValue(d.images[0])},100)):C.replace(b("/video/create"))}).catch(()=>{C.replace(b("/video/create"))}).finally(()=>{g.value=""}))},ee=async()=>{!l.title||!l.value||(g.value="submit",r.value&&(l._id=r.value),l.videoMode!=="my_subject"&&delete l.images,await K.saveProduct(l).then(async o=>{const t=o?.data?.productId;t&&(C.replace(b(`/video/${t}`)),O())}).catch(()=>{g.value=""}))};return G(()=>{O("detail")}),G(()=>{f.on(`server:product-detail:${r.value}`,async o=>{await O(),fe(()=>{o.state==="success"?window.scrollTo({top:0,behavior:"smooth"}):Z()})})}),pe(()=>{f.off(`server:product-detail:${r.value}`)}),ke({title:v(r.value?"Chi tiết":"Tạo video"),description:"Nền tảng AI giúp bạn tạo video chuyên nghiệp chỉ trong vài phút",image:"/images/page-detail.png"}),(o,t)=>{const d=y("v-progress-circular"),E=Ce,j=y("v-icon"),m=y("v-col"),te=y("v-divider"),J=Me,N=y("v-row"),le=y("v-text-field"),I=y("v-select"),oe=y("v-textarea"),ne=y("v-timeline-item"),ae=y("v-timeline");return e(g)==="detail"?(u(),_("div",Re,[i(d,{width:"2",size:"40",color:"primary",indeterminate:""}),h(" "+c(o.$t("Đang tải dữ liệu...")),1)])):(u(),p(N,{key:1},{default:s(()=>[i(m,{cols:"12",lg:"6",md:"6"},{default:s(()=>[e(l).video?(u(),_("div",De,[n("div",Pe,[i(E,{src:e(l).video,frameRate:e(l).frameRate,removeControls:["settings"]},null,8,["src","frameRate"])]),n("div",{class:$(["cta-button w-100 justify-center",{disabled:!e(l).title||!e(l).value||e(g)==="download"}]),style:{"border-radius":"6px"},onClick:t[0]||(t[0]=a=>{("downloadVideo"in o?o.downloadVideo:e(ye))(e(l).video,e(l).title,H=>{g.value=H})})},[e(g)==="download"?(u(),p(d,{key:0,width:"2",size:"23",color:"white",indeterminate:""})):(u(),p(j,{key:1,size:"27"},{default:s(()=>[...t[11]||(t[11]=[h("mdi-tray-arrow-down",-1)])]),_:1})),n("h3",null,c(o.$t("Tải video")),1)],2),n("h2",Ue,c(e(l).title),1),i(N,{dense:""},{default:s(()=>[i(m,{cols:"6"},{default:s(()=>[n("div",null,[n("span",ze,c(o.$t("Mô hình"))+":",1),t[12]||(t[12]=n("br",null,null,-1)),h(" "+c(e(q).find(a=>a.value===e(l).modelVideo)?.title||o.$t("Chưa có")),1)])]),_:1}),i(m,{cols:"6"},{default:s(()=>[n("div",null,[n("span",Ie,c(o.$t("Tỷ lệ khung hình"))+":",1),t[13]||(t[13]=n("br",null,null,-1)),h(" "+c(e(F).find(a=>a.value===e(l).frameRate)?.title||o.$t("Chưa có")),1)])]),_:1}),i(m,{cols:"6"},{default:s(()=>[n("div",null,[n("span",Fe,c(o.$t("Chế độ"))+":",1),t[14]||(t[14]=n("br",null,null,-1)),h(" "+c(e(U).find(a=>a.value===e(l).videoMode)?.title||o.$t("Chưa có")),1)])]),_:1}),i(m,{cols:"6"},{default:s(()=>[n("div",null,[n("span",Ae,c(o.$t("Phong cách"))+":",1),t[15]||(t[15]=n("br",null,null,-1)),h(" "+c(e(A).find(a=>a.value===e(l).videoStyle)?.title||o.$t("Chưa có")),1)])]),_:1}),i(m,{cols:"6"},{default:s(()=>[n("div",null,[n("span",Le,c(o.$t("Thời lượng"))+":",1),t[16]||(t[16]=n("br",null,null,-1)),h(" "+c(e(L).find(a=>a.value===e(l).videoDuration)?.title||o.$t("Chưa có")),1)])]),_:1}),i(m,{cols:"6"},{default:s(()=>[n("div",null,[n("span",je,c(o.$t("Tác giả"))+":",1),t[17]||(t[17]=n("br",null,null,-1)),h(" "+c(e(l)?.account?.name||o.$t("Chưa có")),1)])]),_:1}),i(te,{class:"my-2"}),e(l).hasImage?(u(),p(m,{key:0,cols:"12"},{default:s(()=>[n("div",null,[n("span",xe,c(o.$t("Ảnh chủ thể"))+":",1),t[18]||(t[18]=n("br",null,null,-1)),i(J,{ref_key:"uploadImageRef",ref:z,readonly:!0,height:e(V)>550?"10rem":"8rem",iconUpload:"mdi-image-outline",textUpload:"Chọn ảnh",class:"mt-2 mb-1"},null,8,["height"])])]),_:1})):k("",!0),i(m,{cols:"12"},{default:s(()=>[n("div",null,[n("span",Oe,c(o.$t("Prompt"))+":",1),t[19]||(t[19]=n("br",null,null,-1)),n("span",{innerHTML:e(l).value,style:{"white-space":"pre-line"}},null,8,Ee)])]),_:1})]),_:1})])):(u(),_("div",Ne,[i(N,null,{default:s(()=>[i(m,{cols:"12"},{default:s(()=>[i(le,{modelValue:e(l).title,"onUpdate:modelValue":t[1]||(t[1]=a=>e(l).title=a),"hide-details":"",class:$(["w-100",{disabled:!!e(r)}]),variant:"outlined",label:o.$t("Tiêu đề")+" (✳)",readonly:!!e(r)},null,8,["modelValue","label","readonly","class"])]),_:1}),i(m,{cols:"12",lg:"6",md:"6",sm:"6"},{default:s(()=>[i(I,{modelValue:e(l).modelVideo,"onUpdate:modelValue":t[2]||(t[2]=a=>e(l).modelVideo=a),"hide-details":"",class:$(["w-100",{disabled:!!e(r)}]),variant:"outlined","item-title":"title","item-value":"value",items:e(q),readonly:!!e(r),label:o.$t("Mô hình")},null,8,["modelValue","items","readonly","class","label"])]),_:1}),i(m,{cols:"12",lg:"6",md:"6",sm:"6"},{default:s(()=>[i(I,{modelValue:e(l).frameRate,"onUpdate:modelValue":t[3]||(t[3]=a=>e(l).frameRate=a),"hide-details":"",class:$(["w-100",{disabled:!!e(r)}]),variant:"outlined","item-title":"title","item-value":"value",items:e(F),readonly:!!(e(r)||e(l).videoMode==="short_form_video"),label:o.$t("Tỷ lệ khung hình")},null,8,["modelValue","items","readonly","class","label"])]),_:1}),i(m,{cols:"12",lg:"6",md:"6",sm:"6"},{default:s(()=>[i(I,{modelValue:e(l).videoMode,"onUpdate:modelValue":[t[4]||(t[4]=a=>e(l).videoMode=a),t[5]||(t[5]=()=>{e(A).some(a=>a.value===e(l).videoStyle)||(e(l).videoStyle=e(A)[0].value),e(L).some(a=>a.value===e(l).videoDuration)||(e(l).videoDuration=e(L)[0].value),e(l).videoMode==="short_form_video"&&(e(l).frameRate="vertical")})],"hide-details":"",class:$(["w-100",{disabled:!!e(r)}]),variant:"outlined","item-title":"title","item-value":"value",items:e(U),readonly:!!e(r),label:o.$t("Chế độ")},null,8,["modelValue","items","readonly","class","label"])]),_:1}),i(m,{cols:"12",lg:"6",md:"6",sm:"6"},{default:s(()=>[i(I,{modelValue:e(l).videoStyle,"onUpdate:modelValue":t[6]||(t[6]=a=>e(l).videoStyle=a),"hide-details":"",class:$(["w-100",{disabled:!!e(r)}]),variant:"outlined","item-title":"title","item-value":"value",items:e(A),readonly:!!e(r),label:o.$t("Phong cách")},null,8,["modelValue","items","readonly","class","label"])]),_:1}),i(m,{cols:"12"},{default:s(()=>[i(I,{modelValue:e(l).videoDuration,"onUpdate:modelValue":t[7]||(t[7]=a=>e(l).videoDuration=a),"hide-details":"",class:$(["w-100",{disabled:!!e(r)}]),variant:"outlined","item-title":"title","item-value":"value",items:e(L),readonly:!!e(r),label:o.$t("Thời lượng")},null,8,["modelValue","items","readonly","class","label"])]),_:1}),e(l).videoMode==="my_subject"?(u(),p(m,{key:0,cols:"12"},{default:s(()=>[i(J,{ref_key:"uploadImageRef",ref:z,class:$({disabled:!!e(r)}),height:e(V)>550?"10rem":"8rem",iconUpload:"mdi-image-outline",textUpload:"Chọn ảnh",onOnSelectFile:t[8]||(t[8]=a=>e(l).images=[a?.file])},{default:s(()=>[e(g)=="Đang xử lý thông tin..."?(u(),_("div",He,[...t[20]||(t[20]=[n("div",{class:"scan-line"},null,-1)])])):k("",!0)]),_:1},8,["class","height"])]),_:1})):k("",!0),i(m,{cols:"12"},{default:s(()=>[i(oe,{modelValue:e(l).value,"onUpdate:modelValue":t[9]||(t[9]=a=>e(l).value=a),rows:"6","auto-grow":"","hide-details":"",class:$(["w-100",{disabled:!!e(r)}]),variant:"outlined",label:"Prompt (✳)",readonly:!!e(r)},null,8,["modelValue","readonly","class"])]),_:1}),(!e(l)?.account?._id||e(w)?._id===e(l)?.account?._id)&&(!e(r)||e(S))?(u(),p(m,{key:1,cols:"12"},{default:s(()=>[n("div",{class:$(["cta-button w-100 justify-center",{disabled:!e(l).title||!e(l).value||e(g)==="submit"||e(l).videoMode==="my_subject"&&!e(z)?.base64}]),style:{"border-radius":"6px"},onClick:t[10]||(t[10]=a=>ee())},[e(g)==="submit"?(u(),p(d,{key:0,width:"2",size:"23",color:"white",indeterminate:""})):(u(),p(j,{key:1,size:"27"},{default:s(()=>[...t[21]||(t[21]=[h("mdi-image-filter-tilt-shift",-1)])]),_:1})),n("h3",null,c(e(S)?o.$t("Tạo lại video"):o.$t("Tạo video")),1)],2)]),_:1})):k("",!0)]),_:1})]))]),_:1}),i(m,{lg:"6",md:"6",cols:"12"},{default:s(()=>[n("div",{ref_key:"myTimeline",ref:B},[i(ae,{side:"end",class:"mb-4",direction:"vertical",density:"compact"},{default:s(()=>[(u(!0),_(he,null,ge(e(r)?e(l).messages:[{title:"Hoàn tất thông tin",dateTime:"",color:"grey"}],(a,H)=>(u(),p(ne,{key:H,"dot-color":a.color,size:"small"},{icon:s(()=>[a.color==="success"?(u(),p(j,{key:0,color:"white",size:"20"},{default:s(()=>[...t[22]||(t[22]=[h(" mdi-check ",-1)])]),_:1})):a.color==="primary"?(u(),p(d,{key:1,color:"white",width:"2",size:"16",indeterminate:""})):k("",!0),a.color==="error"?(u(),p(j,{key:2,color:"white",size:"20"},{default:s(()=>[...t[23]||(t[23]=[h(" mdi-close ",-1)])]),_:1})):k("",!0)]),default:s(()=>[n("div",null,[n("div",Ge,c(W(a.title)),1),n("div",Qe,c(a.dateTime),1),a.note?(u(),_("div",qe,c(W(a.note)),1)):k("",!0),e(w)?.role===("EnumAccountRole"in o?o.EnumAccountRole:e(_e)).ADMIN&&a.errorMsg?(u(),_("div",We,c(a.errorMsg),1)):k("",!0)])]),_:2},1032,["dot-color"]))),128))]),_:1})],512)]),_:1}),e(l)?.account?._id&&e(w)?._id!==e(l)?.account?._id?(u(),p(m,{key:0,cols:"12",class:"mt-6"},{default:s(()=>[n("div",Je,[t[24]||(t[24]=h(" © Thước phim được sáng tạo bởi ",-1)),n("span",Ke,c(e(l).account?.name),1),t[25]||(t[25]=n("br",null,null,-1)),t[26]||(t[26]=h(" Hãy tôn trọng tác giả và không sử dụng cho các mục đích vi phạm. ",-1))])]),_:1})):k("",!0)]),_:1}))}}}),at=Y(Xe,[["__scopeId","data-v-27bde93a"]]);export{at as default};
