import{_ as J}from"./B8y88hpV.js";import{_ as K}from"./BYdc3zRc.js";import{E as R}from"./C4IxTLi6.js";import"./CQW_vi0x.js";import{a as A}from"./DB3FtL0z.js";import{_ as Q}from"./C5KoYXvH.js";import{d as W,O as X,F as Y,k as r,r as f,L as Z,y,z as g,C as o,D as i,A as l,G as k,B as c,H as a,g as m,N as ee,E as V,I as te,_ as ae}from"./CThe8rmN.js";import{u as ne}from"./BTM_bmsK.js";import{s as le}from"./nvZ7vHZN.js";import{f as oe}from"./BrZZEpxw.js";const se={class:"d-flex flex-column ga-3",style:{"min-height":"24rem"}},ie={key:0,style:{"margin-top":"-10px"}},re={key:0,class:"d-flex align-center ga-2 py-2 px-3",style:{"background-color":"#8d8d8d"}},ce={class:"d-flex flex-column",style:{color:"#fff"}},me={class:"mb-4 bg-brown-lighten-5 px-4 py-2"},ue={class:"d-flex ga-3 mt-6"},de={style:{"min-width":"14rem"}},fe=W({__name:"AccountTable",setup(pe){const N=X(),{t:b}=Y(),{onGetterMasterData:M}=ne(),I=r(()=>{const e=[{title:"Họ và tên",key:"name",sortable:!1},{title:"Email",key:"email",sortable:!1},{title:"Thời hạn còn lại",key:"remainingTime",sortable:!1},{title:"Ngày tham gia",key:"createdAt",sortable:!1},{title:"Người giới thiệu",key:"referral.name",sortable:!1},{title:"Cập nhật",key:"updatedAt",sortable:!1},{title:"Trạng thái",key:"status",align:"center",sortable:!1},{title:"Thao tác",key:"action",align:"center",sortable:!1}];return u.value===R.ADMIN&&(e.splice(4,1),e.pop()),e}),C=f({}),_=f(""),T=f(null),p=f(null),D=f(null),u=r(()=>N.path?.split("/")?.pop()||"user"),t=Z({name:"",email:"",referral:{_id:null},price:69e3,rentalMonths:1}),E=r(()=>le?.map(e=>({...e,title:b(e.title)}))),$=r(()=>u.value==="user"?[{title:"60.000 VND",value:6e4},{title:"69,000 VND",value:69e3},{title:"99,000 VND",value:99e3}]:[{title:"99,000 VND",value:99e3}]),z=r(()=>M.value["rental-months"]?.map(e=>({title:b(e.title),value:e.value}))||[]),B=r(()=>oe(t.price*t.rentalMonths));async function S(e){const n={...e,role:u.value};_.value="load-table",await A.getAllAccount(n).then(d=>{d.data&&(C.value=d.data)}).finally(()=>{_.value=""})}const h=async e=>{t.accountId=e._id,t.name=e.name,t.email=e.email,t.referral=e.remainingTime==="Chưa từng đăng ký"&&e.referral?e.referral:{isReferral:!1},t.price=u.value!=="user"?99e3:69e3,t.rentalMonths=1,t.remainingTime=e.remainingTime||"Chưa từng đăng ký"},O=async e=>{e.action=="view"&&h(e.item)},j=e=>{h(e),p.value.onDisplay(!0)},F=async()=>{let e={accountId:t.accountId,price:t.price,rentalMonths:t.rentalMonths};D.value.show({message:"Bạn có chắc muốn đăng ký địch vụ cho khách hàng?",noTransMsg:!0,onConfirm:async()=>{await A.serviceRegistration(e).then(()=>{h({}),T.value?.loadItems(),p.value.onDisplay(!1)})}})},G=e=>{window.open(`https://tnsolve.com/partner?id=${e?._id}`,"_blank")};return(e,n)=>{const d=m("v-img"),H=m("v-avatar"),P=m("v-divider"),x=m("v-select"),v=m("v-btn"),U=J,w=m("v-icon"),L=K;return g(),y(te,null,[o(Q,{ref_key:"confirmDialogRef",ref:D},null,512),o(U,{ref_key:"commonDialogRef",ref:p,title:"Đăng ký dịch vụ",width:"500"},{default:i(()=>[l("div",se,[l("div",null,[n[3]||(n[3]=l("h3",{class:"font-bold mb-1"},"Thông tin người dùng",-1)),l("h4",null,c(a(t).name),1),l("h4",null,c(a(t).email),1)]),a(t).referral.name&&a(t).remainingTime==="Chưa từng đăng ký"?(g(),y("div",ie,[l("div",null,[n[4]||(n[4]=l("div",{class:"text-blue mb-2"},"Người giới thiệu:",-1)),a(t).referral.name?(g(),y("div",re,[o(H,null,{default:i(()=>[o(d,{src:a(t).referral?.avatar||"/images/avatar-default.jpg","lazy-src":a(t).referral?.avatar||"/images/avatar-default.jpg"},{placeholder:i(()=>[o(d,{src:"/images/avatar-default.jpg"})]),_:1},8,["src","lazy-src"])]),_:1}),l("div",ce,[l("span",null,c(a(t).referral?.name),1),l("span",null,c(a(t).referral?.email),1)])])):k("",!0)])])):k("",!0),o(P,{class:"mt-1"}),l("div",null,[n[5]||(n[5]=l("h3",{class:"font-bold"},"Thông tin thanh toán",-1)),o(x,{modelValue:a(t).price,"onUpdate:modelValue":n[0]||(n[0]=s=>a(t).price=s),"hide-details":"",class:"w-100 mt-4",variant:"outlined","item-title":"title","item-value":"value",items:a($),label:e.$t("Giá gói")},null,8,["modelValue","items","label"]),o(x,{modelValue:a(t).rentalMonths,"onUpdate:modelValue":n[1]||(n[1]=s=>a(t).rentalMonths=s),class:"w-100 mt-4",variant:"outlined","item-title":"title","item-value":"value",items:a(z),label:e.$t("Thời hạn đăng ký")},null,8,["modelValue","items","label"])]),l("h3",me," Tổng cộng: "+c(a(B)),1)]),l("div",ue,[o(v,{text:"Hủy bỏ",class:"flex-1",variant:"tonal",color:"primary",style:{height:"48px"},onClick:n[2]||(n[2]=s=>a(p)?.onDisplay(!1))}),o(v,{text:"Đăng ký",class:"flex-1",variant:"flat",color:"primary",style:{height:"48px"},onClick:F})])]),_:1},512),o(L,{ref_key:"dataTableRef",ref:T,filters:[{label:"Trạng thái",field:"status",type:"select",items:a(E)}],showSelect:!1,actions:[],rowActions:["register"],headers:a(I),data:a(C),loading:a(_)=="load-table",onChange:S,onAction:O},{"row-name":i(({item:s})=>[l("div",de,c(s.name),1)]),"row-action":i(({item:s})=>[a(u)===("EnumAccountRole"in e?e.EnumAccountRole:a(R)).PARTNER?(g(),ee(v,{key:0,icon:"",size:"40",variant:"text",onClick:q=>G(s)},{default:i(()=>[o(w,{size:"20"},{default:i(()=>[...n[6]||(n[6]=[V("mdi-eye-outline",-1)])]),_:1})]),_:1},8,["onClick"])):k("",!0),o(v,{icon:"",size:"40",variant:"text",onClick:q=>j(s)},{default:i(()=>[o(w,{size:"20"},{default:i(()=>[...n[7]||(n[7]=[V("mdi-account-plus-outline",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1},8,["filters","headers","data","loading"])],64)}}}),xe=ae(fe,[["__scopeId","data-v-fc7926a6"]]);export{xe as A};
